name: Build and Deploy Assemble

on:
  workflow_dispatch:        # Manuell start via Actions
  schedule:
    - cron: "0 6 * * *"     # KÃ¶r automatiskt varje dag kl 06:00 UTC

jobs:
  assemble:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    env:
      JOB_TYPE: assemble
      LEAGUE: premier_league
      LANG: en

      # Azure-secrets (standard enligt Best_Practice_Skriva_till_Azure_Blob.md)
      AZURE_STORAGE_ACCOUNT:   ${{ secrets.AZURE_STORAGE_ACCOUNT }}
      AZURE_STORAGE_CONTAINER: ${{ secrets.AZURE_CONTAINER }}
      BLOB_CONTAINER_SAS_URL:  ${{ secrets.BLOB_CONTAINER_SAS_URL }}
      AZURE_CLIENT_ID:         ${{ secrets.AZURE_CLIENT_ID }}
      AZURE_TENANT_ID:         ${{ secrets.AZURE_TENANT_ID }}
      AZURE_CLIENT_SECRET:     ${{ secrets.AZURE_CLIENT_SECRET }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Build Docker image
        run: docker build -t afp .

      - name: Run Assemble job
        run: |
          docker run --rm \
            -e JOB_TYPE=${JOB_TYPE} \
            -e LEAGUE=${LEAGUE} \
            -e LANG=${LANG} \
            -e AZURE_STORAGE_ACCOUNT=${AZURE_STORAGE_ACCOUNT} \
            -e AZURE_STORAGE_CONTAINER=${AZURE_STORAGE_CONTAINER} \
            -e BLOB_CONTAINER_SAS_URL="${BLOB_CONTAINER_SAS_URL}" \
            -e AZURE_CLIENT_ID=${AZURE_CLIENT_ID} \
            -e AZURE_TENANT_ID=${AZURE_TENANT_ID} \
            -e AZURE_CLIENT_SECRET=${AZURE_CLIENT_SECRET} \
            afp
