flowchart TD

  %% RAW LAYER
  subgraph RAW["RAW (JSON-filer)"]
    A1["players_africa_master.json"]
    A2["players_africa_history.json"]
    A3["player_history_<league>.json"]
    A4["teams/<league>/<team>.json"]
    A5["leagues.yaml / leagues.json"]
    A6["seasons_<league>.json"]
    A7["stats/<season>/<league>/<match>.json"]
    A8["stats/<season>/<league>/players/<player>.json"]
    A9["stats/players/<player>/totals.json"]
    A10["africa_fifa_codes.json"]
  end

  %% BASE LAYER
  subgraph BASE["BASE Layer (Parquet)"]
    B1["players_flat.parquet\n(id, name, country, aliases, club_history, sources)"]
    B2["teams_flat.parquet\n(team_id, name, league_id, stadium, country)"]
    B3["leagues_flat.parquet\n(league_id, name, country, is_cup)"]
    B4["seasons_flat.parquet\n(league_id, season, is_active)"]
    B5["matches_flat.parquet\n(match_id, date, league_id, home_id, away_id, score, odds)"]
    B6["events_flat.parquet\n(event_id, match_id, player_id, type, minute, assist_player_id)"]
    B7["player_match_stats.parquet\n(player_id, league_id, season, apps, goals, assists, cards, subs)"]
    B8["player_totals.parquet\n(player_id, apps, goals, assists, cards, subs)"]
    B9["countries_flat.parquet\n(FIFA_code, country_name)"]
  end

  %% METRICS LAYER
  subgraph METRICS["METRICS Layer (Parquet)"]
    M1["goals_africa.parquet\n(player_id, country, season, total_goals)"]
    M2["assists_africa.parquet\n(player_id, country, season, total_assists)"]
    M3["clean_sheets_africa.parquet\n(player_id, country, season, clean_sheets)"]
    M4["form_index.parquet\n(player_id, country, rolling_window, form_score)"]
    M5["milestones.parquet\n(player_id, country, type, threshold, reached_flag)"]
  end

  %% CONTENT LAYER
  subgraph CONTENT["CONTENT (Sektioner i pipeline)"]
    C1["S.STATS.GOALSCORERS"]
    C2["S.STATS.ASSISTS"]
    C3["S.STATS.CLEAN_SHEETS"]
    C4["S.STATS.FORM"]
    C5["S.STATS.MILESTONES"]
  end

  %% Connections RAW -> BASE
  A1 --> B1
  A2 --> B1
  A3 --> B1
  A4 --> B2
  A5 --> B3
  A6 --> B4
  A7 --> B5
  A7 --> B6
  A8 --> B7
  A9 --> B8
  A10 --> B9

  %% Connections BASE -> METRICS
  B1 --> M1
  B6 --> M1
  B7 --> M1
  B1 --> M2
  B6 --> M2
  B7 --> M2
  B5 --> M3
  B6 --> M3
  B7 --> M3
  B6 --> M4
  B7 --> M4
  B8 --> M5

  %% Connections METRICS -> CONTENT
  M1 --> C1
  M2 --> C2
  M3 --> C3
  M4 --> C4
  M5 --> C5
