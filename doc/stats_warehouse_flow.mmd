flowchart TD

  subgraph BASE["ðŸŸ¦ BASE (One-time setup)"]
    TEAMS[teams_flat_parquet]
    PLAYERS[players_flat_parquet]
    LEAGUES[leagues_flat_parquet]
  end

  subgraph PERSEASON["ðŸŸ¨ PER SEASON (Once per year)"]
    SEASONS[seasons_flat_parquet]
    HISTORIC[Optional_add_historic_season]
  end

  subgraph WEEKLY["ðŸŸ© WEEKLY (Each round)"]
    COLLECT[collect_stats_fullseason â†’ matches_json]
    MANIFEST[build_matches_events_all â†’ manifest_json]
    EXTRACT[collect_extract_weekly â†’ player_match_events]
    EVENTS[events_flat_season_league_parquet]
    PSTATS[player_match_stats_parquet]
  end

  %% Relations
  TEAMS --> COLLECT
  PLAYERS --> COLLECT
  LEAGUES --> SEASONS
  SEASONS --> COLLECT
  COLLECT --> MANIFEST
  MANIFEST --> EXTRACT
  EXTRACT --> EVENTS
  EXTRACT --> PSTATS
