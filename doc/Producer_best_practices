# AFP ‚Äì Config, Lookups & GPT-integration (Sammanfattning)

Denna fil sammanfattar hur vi bygger sektioner i AFP-projektet utan h√•rdkodning, med r√§tt config-styrning och GPT-bearbetning.  

---

## üîß Grundfl√∂de NEWS/OPINION/GENERIC/CLUB/STATS

1. **Collect (rss_multi)**  
   - H√§mtar r√•a nyheter fr√•n ~17 RSS-feeds.  
   - Sparas i `curated/news/<feed>/<league>/<date>/items.json`.  
   - H√§r finns allt m√∂jligt (√§ven rugby, boxning osv).  

2. **Candidates**  
   - `produce_candidates` vaskar fram bara nyheter som n√§mner afrikanska spelare (via masterlist).  
   - Output: `candidates.jsonl`.  

3. **Scoring**  
   - `produce_scoring` ber√§knar relevans (`score`, `recency_score`, `novelty`, `authority`).  
   - Output: `scored.jsonl`.  

4. **Sections**  
   - Varje sektion (`s_news_top3_generic`, `s_news_club_highlight`, `s_stats_*`) h√§mtar **scored.jsonl** ‚Üí aldrig r√•a RSS.  
   - Helpers i `src/sections/utils.py`:  
     - `load_candidates` (scored)  
     - `get_persona_block` (role ‚Üí persona-block)  
     - `write_outputs` (sparar section.json/md/manifest i Azure).  

---

## üé≠ Roller & Personas (ingen h√•rdkodning)

- **sections_library.yaml**: varje sektion har en `role:` (`news_anchor`, `expert`).  
- **pods.yaml**: varje pod mappar roll ‚Üí persona-id (ex: `news_anchor: "AK"`, `expert: "JJK"`).  
- **personas.json**: definierar varje persona (namn, r√∂st, ton, stil, catchphrases).  
- **role_utils.py**:  
  - L√§ser `pods.yaml`.  
  - Returnerar persona-id f√∂r en role.  
  - Fallback: `news_anchor ‚Üí AK`, annars f√∂rsta `personas_active`.  
- **utils.get_persona_block**:  
  - Returnerar b√•de `persona_id` och ett f√§rdigt ‚Äúpersona-block‚Äù (fr√•n personas.json) som kan skickas in i GPT.  

---

## üß† GPT-integration

- Wrapper: `src/gpt.py` ‚Üí `run_gpt(prompt_config, ctx, system_rules)`.  
- Sektioner (t.ex. Top3, Club Highlight):  
  - Tar `title` + `source.url` fr√•n scored items.  
  - Bygger prompt med `persona_block` + ‚Äúinstructions‚Äù (summarize, club spotlight osv).  
  - GPT skriver korta, talv√§nliga sammanfattningar (2‚Äì3 meningar, journalistisk stil).  
- Payload:  
  ```yaml
  meta:
    role: news_anchor
    persona: AK
